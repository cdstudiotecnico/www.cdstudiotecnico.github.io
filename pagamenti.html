<!DOCTYPE html>
<html lang="it">
<head>

        <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TDC4FVDX');</script>
<!-- End Google Tag Manager -->

  <!-- Verifica Google Search Console -->
  <meta name="google-site-verification" content="5-kam6aK3nMX8pb5dczefcCj29VOOaRr7Fop8z9jWI8" />

  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <!-- Titolo e Descrizione -->
  <title>Pagamenti | CD Studio Tecnico – Ing. Dario Cucchiara</title>
  <meta name="description" content="Pagina Pagamenti CD Studio Tecnico: bonifico bancario o postale e richiesta link Klarna via WhatsApp. Calcolo automatico del lordo a pagare secondo preventivo ufficiale.">
  <meta name="author" content="Ing. Dario Cucchiara">
  <meta name="robots" content="index, follow">
  <meta name="keywords" content="pagamenti, bonifico, klarna, ingegnere, studio tecnico, preventivo, fattura, Partinico, Palermo, consulenze tecniche online">
  <meta name="rating" content="general">
  <meta name="revisit-after" content="7 days">

  <!-- Canonical URL -->
  <link rel="canonical" href="https://www.cdstudiotecnico.it/pagamenti.html">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17708716400"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'AW-17708716400');
  </script>

  <!-- Favicons ufficiali -->
  <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicon-32.png">
  <link rel="icon" type="image/png" sizes="64x64" href="assets/img/favicon-64.png">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/img/favicon-180.png">
  <link rel="icon" type="image/png" sizes="512x512" href="assets/img/favicon-512.png">

  <!-- Social sharing (OpenGraph / Twitter) -->
  <meta property="og:image" content="https://www.cdstudiotecnico.it/assets/img/favicon-512.png">
  <meta name="twitter:image" content="https://www.cdstudiotecnico.it/assets/img/favicon-512.png">

  <!-- Open Graph -->
  <meta property="og:title" content="Pagamenti – CD Studio Tecnico">
  <meta property="og:description" content="Bonifico bancario/postale e richiesta Klarna via WhatsApp. Calcolo del lordo a pagare secondo preventivo ufficiale.">
  <meta property="og:image" content="https://www.cdstudiotecnico.it/assets/img/logo-cdstudiotecnico.jpeg">
  <meta property="og:url" content="https://www.cdstudiotecnico.it/pagamenti.html">
  <meta property="og:site_name" content="CD Studio Tecnico">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="it_IT">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Ing. Dario Cucchiara - CD Studio Tecnico">
  <meta name="twitter:description" content="Ingegneria civile, edile e ambientale. Pagamenti e istruzioni operative.">
  <meta name="twitter:image" content="https://www.cdstudiotecnico.it/assets/img/logo-cdstudiotecnico.jpeg">

  <!-- Fonts e CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Poppins:wght@400;600;700&family=Raleway:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/css/main.css" rel="stylesheet">

<style>
  /* ====== PAGINA PAGAMENTI – SINGLE COLUMN (MOBILE FIRST) ====== */
  #pagamenti {
    background: #f8faf9;
    padding: 58px 0 92px 0;
  }

  .pay-wrap{
    max-width: 760px;
    margin: 0 auto;
    padding: 0 16px;
  }

  .brand-block{
    text-align:center;
    margin: 0 auto 14px auto;
  }
  .brand-block img{
    max-width: 200px;
    filter: drop-shadow(0 3px 8px rgba(0,0,0,0.2));
    margin: 0 auto 10px auto;
    display:block;
  }
  .brand-block h2{
    font-weight: 800;
    color:#356c6c;
    margin: 0 0 10px 0;
    letter-spacing: 0.2px;
  }
  .brand-block .hero-desc{
    max-width: 700px;
    margin: 0 auto;
    padding: 0 8px;
    line-height: 1.7;
    color:#444;
  }
  .brand-block .hero-note{
    max-width: 700px;
    margin: 10px auto 0 auto;
    padding: 0 8px;
    line-height: 1.65;
    color:#555;
    font-weight: 700;
  }

  /* anti-colonne (fix definitivo) */
  .brand-block p, .hero-desc, .hero-note {
    column-count: 1 !important;
    columns: 1 !important;
    -webkit-column-count: 1 !important;
    -moz-column-count: 1 !important;
  }

  .cardish{
    background: #fff;
    border-radius: 18px;
    box-shadow: 0 10px 28px rgba(0,0,0,0.08);
    padding: 18px 18px;
    margin-top: 14px;
    border: 1px solid rgba(53,108,108,0.10);
  }

  .cardish h3{
    color:#356c6c;
    font-family: 'Poppins', sans-serif;
    font-weight: 700;
    font-size: 1.05rem;
    margin: 0 0 10px 0;
    display:flex;
    align-items:center;
    gap:10px;
  }

  .mini{
    color:#666;
    font-size: 0.94rem;
    line-height: 1.55;
    margin: 0;
  }

  .danger-note{
    background: #fff6f6;
    border: 1px solid rgba(160, 45, 45, 0.20);
    color:#7b1e1e;
    border-radius: 16px;
    padding: 14px 14px;
  }
  .danger-note strong{ color:#7b1e1e; }

  .form-label{
    font-weight: 700;
    color:#356c6c;
    margin-bottom: 6px;
  }
  .form-control, .form-select{
    border-radius: 12px;
    padding: 12px 14px;
    border: 1.2px solid #cfd6d6;
  }
  .form-control:focus, .form-select:focus{
    border-color:#356c6c;
    box-shadow: 0 0 0 3px rgba(53,108,108,0.12);
  }

  .pill-actions{
    display:flex;
    flex-direction: column;
    gap:10px;
    margin-top: 12px;
  }
  .pill-btn{
    width:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    border-radius: 14px;
    border: 1.6px solid rgba(53,108,108,0.35);
    padding: 12px 14px;
    background: #fff;
    color:#356c6c;
    font-weight: 800;
    text-decoration:none;
    transition: all .25s ease;
  }
  .pill-btn:hover{
    background:#356c6c;
    color:#fff;
    transform: translateY(-1px);
  }
  .pill-btn.soft{
    background: rgba(53,108,108,0.08);
    border-color: rgba(53,108,108,0.18);
  }
  .pill-btn.soft:hover{
    background:#356c6c;
    border-color:#356c6c;
  }
  .pill-btn.whatsapp{
    background: #e9f7f0;
    border-color: rgba(19, 166, 91, 0.25);
    color: #0f6a3f;
  }
  .pill-btn.whatsapp:hover{
    background: #19a85d;
    border-color: #19a85d;
    color: #fff;
  }

  .kv{
    display:flex;
    flex-direction: column;
    gap:8px;
    margin-top: 10px;
  }
  .kv .rowkv{
    display:flex;
    flex-direction: column;
    gap:4px;
    padding: 10px 12px;
    border-radius: 14px;
    background: rgba(53,108,108,0.05);
    border: 1px solid rgba(53,108,108,0.10);
  }
  .kv .k{
    font-weight: 800;
    color:#356c6c;
    font-size: 0.92rem;
  }
  .kv .v{
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size: 0.98rem;
    color:#233;
    word-break: break-all;
  }

  .totals{
    display:flex;
    flex-direction: column;
    gap:10px;
    margin-top: 10px;
  }
  .total-box{
    border-radius: 16px;
    padding: 14px 14px;
    border: 1px solid rgba(53,108,108,0.14);
    background: rgba(53,108,108,0.04);
  }
  .total-box .tlabel{
    font-weight: 800;
    color:#356c6c;
    margin-bottom: 4px;
  }
  .total-box .tval{
    font-size: 1.35rem;
    font-weight: 900;
    color:#163b3b;
    letter-spacing: 0.2px;
  }
  .total-box .tsub{
    font-size: 0.92rem;
    color:#555;
    margin-top: 4px;
    line-height: 1.45;
  }

  .hint{
    font-size: 0.92rem;
    color:#666;
    margin-top: 8px;
    line-height:1.55;
  }

  /* Sticky bar (mobile) */
  .sticky-actions{
    position: fixed;
    left: 0;
    right: 0;
    bottom: 10px;
    z-index: 999;
    padding: 0 12px;
  }
  .sticky-inner{
    max-width: 760px;
    margin: 0 auto;
    display:flex;
    gap:10px;
    background: rgba(255,255,255,0.96);
    border: 1px solid rgba(53,108,108,0.18);
    border-radius: 18px;
    padding: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.10);
    backdrop-filter: blur(8px);
  }
  .sticky-inner a{
    flex:1;
    border-radius: 14px;
    padding: 12px 10px;
    font-weight: 900;
    text-decoration:none;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
  }
  .sticky-inner .s-copy{
    background:#fff;
    border: 1.6px solid rgba(53,108,108,0.35);
    color:#356c6c;
  }
  .sticky-inner .s-copy:hover{
    background:#356c6c;
    color:#fff;
  }
  .sticky-inner .s-wa{
    background:#19a85d;
    color:#fff;
    border: 1.6px solid rgba(25,168,93,0.45);
  }
  .sticky-inner .s-wa:hover{
    filter: brightness(0.95);
  }

  /* piccoli aggiustamenti */
  @media (max-width: 575px){
    #pagamenti{ padding: 48px 0 110px 0; }
    .cardish{ padding: 16px 14px; }
    .brand-block .hero-desc, .brand-block .hero-note{ padding: 0 6px; }
  }

/* Linea sotto il titolo "Pagamenti" (senza cambiare layout) */
#pagamenti .brand-block h2::after{
  content: "";
  display: block;
  width: 50px;
  height: 3px;
  margin: 12px auto 0;
  background: #356c6c;
  border-radius: 2px;
}
  
</style>

</head>

<body class="contact-page">

<header id="header" class="header d-flex align-items-center light-background sticky-top">
  <div class="container-fluid position-relative d-flex align-items-center justify-content-between">

    <a href="index.html" class="logo d-flex align-items-center me-auto me-xl-0 text-decoration-none">
      <div class="d-flex flex-column">
        <h1 class="sitename mb-0">Ing. Dario Cucchiara</h1>
        <span class="subtitle">Ingegneria Civile, Edile & Ambientale</span>
      </div>
    </a>

    <nav id="navmenu" class="navmenu">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="resume.html">Curriculum</a></li>
        <li><a href="services.html">Servizi</a></li>
        <li><a href="preventivo.html">Richiedi Preventivo</a></li>
        <li><a href="portfolio.html">Portfolio</a></li>
        <li><a href="pagamenti.html" class="active">Pagamenti</a></li>
        <li><a href="contact.html">Contatti</a></li>
      </ul>
      <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
    </nav>

    <div class="header-social-links">
      <a href="mailto:cdstudiotecnico@hotmail.com" class="email"><i class="bi bi-envelope"></i></a>
      <a href="tel:+393289250353" class="phone"><i class="bi bi-telephone"></i></a>
    </div>

  </div>
</header>

<main class="main">
  <h1 style="display:none;">Pagamenti – CD Studio Tecnico – Ing. Dario Cucchiara</h1>

  <section id="pagamenti" class="section">
    <div class="pay-wrap" data-aos="fade-up">

      <!-- HERO -->
      <div class="brand-block">
        <img src="assets/img/logo.png" alt="Logo CD Studio Tecnico">
        <h2 class="section-title-h2">Pagamenti</h2>

        <p class="hero-desc">
          Inserisci <strong>esclusivamente l’importo indicato nel preventivo ufficiale</strong>.
          Il sistema calcola automaticamente il <strong>lordo a pagare</strong> applicando:
          <strong>marca da bollo € 2,00</strong> (solo se dovuta), <strong>INPS 4%</strong> e <strong>Inarcassa 4%</strong>.
          In caso di pagamento con Klarna, viene applicata una <strong>maggiorazione del 6%</strong> sul lordo.
        </p>

        <p class="hero-note">
          Importante: l’importo valido è esclusivamente quello riportato nel preventivo ufficiale.
          Pagamenti con importo difforme potrebbero ritardare l’avvio della pratica e la richiesta di ulteriori pagamenti compensativi.
          Lavorazione avviata solo dopo ricezione del compenso (o contabile in caso di urgenza).
        </p>

        <div style="margin-top:10px;">
          <a href="privacy.html" target="_blank" style="color:#356c6c; font-weight:800; text-decoration:none;">Privacy Policy</a>
        </div>
      </div>

      <!-- AVVISO CRITICO -->
      <div class="cardish danger-note">
        <h3><i class="bi bi-exclamation-triangle"></i> Avviso</h3>
        <p class="mini" style="margin:0;">
          <strong>Bonifico istantaneo consigliato.</strong> La lavorazione delle pratiche avviene solo dopo aver ricevuto il compenso dovuto (o contabile in caso di urgenza).
          La marca da bollo è prevista per <strong>operazioni fuori campo IVA / escluse / esenti</strong> di importo superiore a <strong>€ 77,47</strong>.
          Se l’importo inserito è pari o inferiore a € 77,47, la marca da bollo <strong>non viene applicata</strong>.
        </p>
      </div>

      <!-- 1) DATI PAGAMENTO + CALCOLO -->
      <div class="cardish">
        <h3><i class="bi bi-calculator"></i> Calcolo importo e causale</h3>

        <div class="mb-3">
          <label class="form-label" for="netto">Importo da preventivo (netto)</label>
          <input class="form-control" id="netto" type="number" inputmode="decimal" min="0" step="0.01" placeholder="Es. 230.00">
          <div class="hint">Inserisci l’importo come indicato nel preventivo ufficiale (netto). Il sistema calcola il lordo automaticamente.</div>
        </div>

        <div class="mb-3">
          <label class="form-label" for="metodo">Metodo di pagamento</label>
          <select class="form-select" id="metodo">
            <option value="bonifico" selected>Bonifico (bancario / postale)</option>
            <option value="klarna">Klarna (richiesta link via WhatsApp)</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label" for="fatturaNum">Numero fattura (placeholder)</label>
          <input class="form-control" id="fatturaNum" type="text" placeholder="Es. 123">
        </div>

        <div class="mb-3">
          <label class="form-label" for="fatturaData">Data fattura (GG/MM/AAAA)</label>
          <input class="form-control" id="fatturaData" type="text" inputmode="numeric" placeholder="Es. 05/02/2026">
          <div class="hint">La causale verrà generata nel formato: <strong>“Saldo Fattura n. XXX del GG/MM/AAAA”</strong>.</div>
        </div>

        <div class="kv">
          <div class="rowkv">
            <div class="k">Causale</div>
            <div class="v" id="causaleOut">Saldo Fattura n. XXX del GG/MM/AAAA</div>
          </div>
        </div>

        <div class="totals">
          <div class="total-box">
            <div class="tlabel">Marca da bollo</div>
            <div class="tval" id="bolloOut">€ 0,00</div>
            <div class="tsub">Applicata solo per importi superiori a € 77,47 (fuori campo IVA / esenti / escluse).</div>
          </div>

          <div class="total-box">
            <div class="tlabel">Lordo a pagare (bonifico)</div>
            <div class="tval" id="lordoOut">€ 0,00</div>
            <div class="tsub">Calcolo: (netto + bollo) × 1,04 (INPS) × 1,04 (Inarcassa).</div>
          </div>

          <div class="total-box">
            <div class="tlabel">Lordo a pagare (Klarna)</div>
            <div class="tval" id="klarnaOut">€ 0,00</div>
            <div class="tsub">Calcolo: lordo × 1,06 (maggiorazione Klarna).</div>
          </div>

          <div class="total-box">
            <div class="tlabel">Importo da versare (in base al metodo selezionato)</div>
            <div class="tval" id="daVersareOut">€ 0,00</div>
            <div class="tsub">Nota: l’importo valido è esclusivamente quello del preventivo ufficiale. Importi difformi possono ritardare la pratica.</div>
          </div>
        </div>

        <div class="pill-actions">
          <a class="pill-btn" href="#" id="copyCausale"><i class="bi bi-clipboard"></i> Copia causale</a>
          <a class="pill-btn" href="#" id="copyImporto"><i class="bi bi-clipboard"></i> Copia importo da versare</a>
        </div>
      </div>

      <!-- 2) COORDINATE BONIFICO -->
      <div class="cardish">
        <h3><i class="bi bi-bank"></i> Bonifico bancario / postale</h3>
        <p class="mini" style="margin:0 0 10px 0;">
          Consigliato <strong>bonifico istantaneo</strong>. Lavorazione avviata solo dopo ricezione del compenso (o contabile in caso di urgenza).
        </p>

        <div class="kv">
          <div class="rowkv">
            <div class="k">Bonifico Bancario – IBAN</div>
            <div class="v" id="ibanBanca">IT32F0894643460000000502217</div>
          </div>
          <div class="rowkv">
            <div class="k">Banca</div>
            <div class="v">Banca Don Rizzo</div>
          </div>
          <div class="rowkv">
            <div class="k">Intestato a</div>
            <div class="v">Ing. Dario Cucchiara</div>
          </div>
          <div class="rowkv">
            <div class="k">Bonifico Postale – IBAN</div>
            <div class="v" id="ibanPoste">IT90U3608105138266873866892</div>
          </div>
        </div>

        <div class="pill-actions">
          <a class="pill-btn soft" href="#" id="copyIbanBanca"><i class="bi bi-clipboard"></i> Copia IBAN bancario</a>
          <a class="pill-btn soft" href="#" id="copyIbanPoste"><i class="bi bi-clipboard"></i> Copia IBAN postale</a>
        </div>

        <p class="hint" style="margin-bottom:0;">
          Causale: <strong>Saldo Fattura n. XXX del GG/MM/AAAA</strong> (compila sopra i campi “Numero fattura” e “Data fattura”).
        </p>
      </div>

      <!-- 3) DATI FATTURAZIONE (inviati su WhatsApp) -->
      <div class="cardish">
        <h3><i class="bi bi-receipt"></i> Dati di fatturazione</h3>
        <p class="mini" style="margin:0 0 10px 0;">
          Compila i dati che vuoi farci trovare già pronti per l’emissione della fattura. Puoi anche lasciare vuoti i campi non pertinenti.
        </p>

        <div class="mb-3">
          <label class="form-label" for="intestazione">Intestatario fattura (Nome e Cognome / Ragione Sociale)</label>
          <input class="form-control" id="intestazione" type="text" placeholder="Es. Mario Rossi / Rossi S.r.l.">
        </div>

        <div class="mb-3">
          <label class="form-label" for="cf">Codice Fiscale</label>
          <input class="form-control" id="cf" type="text" placeholder="Es. RSSMRA80A01H501U">
        </div>

        <div class="mb-3">
          <label class="form-label" for="piva">Partita IVA (se presente)</label>
          <input class="form-control" id="piva" type="text" placeholder="Es. 01234567890">
        </div>

        <div class="mb-3">
          <label class="form-label" for="indirizzo">Indirizzo</label>
          <input class="form-control" id="indirizzo" type="text" placeholder="Via / Piazza, numero civico">
        </div>

        <div class="mb-3">
          <label class="form-label" for="capCitta">CAP – Città – Provincia</label>
          <input class="form-control" id="capCitta" type="text" placeholder="Es. 90047 Partinico (PA)">
        </div>

        <div class="mb-3">
          <label class="form-label" for="emailFatt">Email (per invio fattura)</label>
          <input class="form-control" id="emailFatt" type="email" placeholder="Es. nome@email.it">
        </div>

        <div class="mb-3">
          <label class="form-label" for="pec">PEC (se presente)</label>
          <input class="form-control" id="pec" type="email" placeholder="Es. nome@pec.it">
        </div>

        <div class="mb-3">
          <label class="form-label" for="sdi">Codice SDI (se presente)</label>
          <input class="form-control" id="sdi" type="text" placeholder="Es. ABCD123">
        </div>

        <div class="mb-3">
          <label class="form-label" for="telefono">Telefono</label>
          <input class="form-control" id="telefono" type="tel" inputmode="tel" placeholder="Es. 3331234567">
        </div>

        <div class="hint" style="margin-top:0;">
          I dati verranno inclusi nel messaggio WhatsApp “Invio ricevuta + dati di fatturazione”.
        </div>
      </div>

      <!-- 4) AZIONI WHATSAPP -->
      <div class="cardish">
        <h3><i class="bi bi-whatsapp"></i> WhatsApp: ricevuta e Klarna</h3>

        <p class="mini" style="margin:0 0 10px 0;">
          Dopo il pagamento, invia ricevuta/contabile su WhatsApp insieme ai dati di fatturazione.
          Se vuoi pagare con Klarna, richiedi il link: verrà generato e inviato su WhatsApp.
        </p>

        <div class="pill-actions">
          <a class="pill-btn whatsapp" id="waRicevuta" href="#" target="_blank" rel="noopener">
            <i class="bi bi-whatsapp"></i> Invia ricevuta + dati di fatturazione
          </a>

          <a class="pill-btn whatsapp" id="waKlarna" href="#" target="_blank" rel="noopener">
            <i class="bi bi-whatsapp"></i> Richiedi link Klarna
          </a>
        </div>

        <p class="hint" style="margin-bottom:0;">
          Suggerimento: per velocizzare l’avvio, allega la contabile e scrivi eventuale urgenza nel messaggio.
        </p>
      </div>

    </div>
  </section>
</main>

<footer id="footer" class="footer light-background">
  <div class="container">
    <div class="copyright text-center">
      <p><span>Sede Operativa:</span> <strong>Via J.F. Kennedy n. 42, Partinico (PA)</strong></p>
      <p><span>Sede Legale:</span> <strong class="px-1 sitename">Via P. Marchese n. 3, Montelepre (PA)</strong></p>
      <p><span>P.IVA:</span> <strong>06513<span style="display:none;">-</span>140829</strong></p>
    </div>
    <div class="social-links d-flex justify-content-center">
      <a href="https://www.facebook.com/share/1BKxwNRBsj/?mibextid=wwXIfr" target="_blank" class="facebook"><i class="bi bi-facebook"></i></a>
      <a href="https://www.instagram.com/cd_studio.tecnico?igsh=M2d2d2NvdnAwdDgz&utm_source=qr" target="_blank" class="instagram"><i class="bi bi-instagram"></i></a>
      <a href="mailto:cdstudiotecnico@hotmail.com" class="email"><i class="bi bi-envelope"></i></a>
      <a href="tel:+393289250353" class="phone"><i class="bi bi-telephone"></i></a>
    </div>
    <div class="credits">
      <p>Designed by <strong> Ing. Dario Cucchiara </strong></p>
    </div>
  </div>
</footer>

<!-- Scroll Top -->
<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

<!-- Preloader -->
<div id="preloader"></div>

<!-- Sticky actions (mobile first) -->
<div class="sticky-actions">
  <div class="sticky-inner">
    <a class="s-copy" href="#" id="stickyCopyIban"><i class="bi bi-clipboard"></i> Copia IBAN</a>
    <a class="s-wa" href="#" id="stickyWa" target="_blank" rel="noopener"><i class="bi bi-whatsapp"></i> Ricevuta</a>
  </div>
</div>

<!-- Vendor JS Files -->
<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/vendor/aos/aos.js"></script>
<script src="assets/vendor/waypoints/noframework.waypoints.js"></script>
<script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
<script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
<script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
<script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
<script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
<script src="assets/js/main.js"></script>

<script>
  AOS.init();

  // ======= COSTANTI DATI =======
  const WHATSAPP_NUMBER = "393289250353";

  const ibanBanca = "IT32F0894643460000000502217";
  const ibanPoste = "IT90U3608105138266873866892";

  // ======= HELPERS =======
  function euro(n){
    if (isNaN(n)) n = 0;
    return n.toLocaleString('it-IT', { style:'currency', currency:'EUR' });
  }
  function parseNum(v){
    if(!v) return 0;
    const s = String(v).replace(",", ".").replace(/[^\d.]/g, "");
    const n = parseFloat(s);
    return isNaN(n) ? 0 : n;
  }
  function buildCausale(){
    const num = (document.getElementById("fatturaNum").value || "XXX").trim();
    const data = (document.getElementById("fatturaData").value || "GG/MM/AAAA").trim();
    return `Saldo Fattura n. ${num} del ${data}`;
  }
  function compute(){
    const netto = parseNum(document.getElementById("netto").value);
    // bollo SOLO se importo > 77,47 (fuori campo IVA / esenti / escluse)
    const bollo = (netto > 77.47) ? 2.00 : 0.00;

    const tot1 = netto + bollo;
    const tot2 = tot1 * 1.04; // INPS
    const lordo = tot2 * 1.04; // Inarcassa
    const klarna = lordo * 1.06;

    return { netto, bollo, lordo, klarna };
  }
  function selectedToPay(){
    const { lordo, klarna } = compute();
    const metodo = document.getElementById("metodo").value;
    return (metodo === "klarna") ? klarna : lordo;
  }

  function buildWhatsAppLink(text){
    const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`;
    return url;
  }

  function billingBlock(){
    const v = id => (document.getElementById(id).value || "").trim();
    const lines = [];

    const intest = v("intestazione");
    const cf = v("cf");
    const piva = v("piva");
    const indir = v("indirizzo");
    const cap = v("capCitta");
    const email = v("emailFatt");
    const pec = v("pec");
    const sdi = v("sdi");
    const tel = v("telefono");

    if(intest) lines.push(`Intestatario: ${intest}`);
    if(cf) lines.push(`CF: ${cf}`);
    if(piva) lines.push(`P.IVA: ${piva}`);
    if(indir) lines.push(`Indirizzo: ${indir}`);
    if(cap) lines.push(`CAP/Città: ${cap}`);
    if(email) lines.push(`Email: ${email}`);
    if(pec) lines.push(`PEC: ${pec}`);
    if(sdi) lines.push(`SDI: ${sdi}`);
    if(tel) lines.push(`Telefono: ${tel}`);

    return lines.length ? lines.join("\n") : "Dati fatturazione: (non inseriti)";
  }

  function refreshUI(){
    const caus = buildCausale();
    document.getElementById("causaleOut").textContent = caus;

    const { bollo, lordo, klarna } = compute();
    document.getElementById("bolloOut").textContent = euro(bollo);
    document.getElementById("lordoOut").textContent = euro(lordo);
    document.getElementById("klarnaOut").textContent = euro(klarna);

    const pay = selectedToPay();
    document.getElementById("daVersareOut").textContent = euro(pay);

    // WhatsApp links sempre attivi
    const metodo = document.getElementById("metodo").value;
    const payText = euro(pay);

    const msgRicevuta =
`Buongiorno, invio ricevuta/contabile del pagamento.

Causale: ${caus}
Metodo: ${metodo === "klarna" ? "Klarna" : "Bonifico"}
Importo versato: ${payText}

${billingBlock()}

Note: (eventuale urgenza / dettagli aggiuntivi)`;

    document.getElementById("waRicevuta").href = buildWhatsAppLink(msgRicevuta);
    document.getElementById("stickyWa").href = buildWhatsAppLink(msgRicevuta);

    const msgKlarna =
`Buongiorno, desidero pagare tramite Klarna.

Causale: ${caus}
Importo da pagare (Klarna): ${euro(compute().klarna)}

${billingBlock()}

Potete inviarmi il link Klarna per procedere?`;

    document.getElementById("waKlarna").href = buildWhatsAppLink(msgKlarna);
  }

  async function copyText(text){
    try{
      await navigator.clipboard.writeText(text);
      return true;
    }catch(e){
      const t = document.createElement("textarea");
      t.value = text;
      document.body.appendChild(t);
      t.select();
      const ok = document.execCommand("copy");
      document.body.removeChild(t);
      return ok;
    }
  }

  function bindCopy(btnId, getTextFn){
    document.getElementById(btnId).addEventListener("click", async (e) => {
      e.preventDefault();
      const ok = await copyText(getTextFn());
      const el = e.currentTarget;
      const old = el.innerHTML;
      el.innerHTML = ok ? '<i class="bi bi-check2"></i> Copiato' : '<i class="bi bi-x"></i> Non copiato';
      setTimeout(() => el.innerHTML = old, 1100);
    });
  }

  // ======= EVENTS =======
  document.addEventListener("DOMContentLoaded", () => {
    // init static outputs
    document.getElementById("ibanBanca").textContent = ibanBanca;
    document.getElementById("ibanPoste").textContent = ibanPoste;

    // refresh on input
    ["netto","metodo","fatturaNum","fatturaData","intestazione","cf","piva","indirizzo","capCitta","emailFatt","pec","sdi","telefono"]
      .forEach(id => document.getElementById(id).addEventListener("input", refreshUI));

    // copy buttons
    bindCopy("copyIbanBanca", () => ibanBanca);
    bindCopy("copyIbanPoste", () => ibanPoste);
    bindCopy("copyCausale", () => buildCausale());
    bindCopy("copyImporto", () => {
      const pay = selectedToPay();
      return pay.toFixed(2).replace(".", ",");
    });

    // sticky copy (default: iban bancario)
    bindCopy("stickyCopyIban", () => ibanBanca);

    // first render
    refreshUI();
  });
</script>

</body>
</html>
